import subprocess #for running scripts
import time #for timer
import ftplib #for FTP connection

session = ftplib.FTP('192.168.0.11','anonymous','')

time_now=time.time()
while (time.time()-time_now)<7:
	dummy=1

#subprocess.call("sudo /etc/init.d/ntp stop", shell=True)
#subprocess.call("sudo ntpd -g -q", shell=True)
subprocess.call("sudo /etc/init.d/ntp start", shell=True) #to syncronize time between the Raspberry Pis

subprocess.call("python Handshake_Subsurface.py", shell=True)
IMU=subprocess.popen(['python' 'Desktop/IMU.py' '&'],bufsize=-1) #starts IMU collection in background

while True:

	t1=time.time() #records time in seconds
	
	while((time.time()-t1)<=10) #collect data for 10 seconds
		dummy=1
		
	#every ten seconds: stop, copy, restart, and send copy
	IMU.kill()
	subprocess.call("sudo cp /home/pi/subsurface_data.csv /home/pi/subsurface_data_copy.csv",shell=True)
	IMU
	t1=time.time();
		
	file = open('subsurface_data_copy.csv','rb')               # file to send
	session.storbinary(STOR 'subsurface_data_copy.csv', file)     	 # send the file
	file.close()                                    	 # close file and FTP 
